{
  "rules": {
    "sessions": {
      "$sessionId": {
        ".validate": "$sessionId.matches(/^[A-Z0-9]{6}$/)",
        
        "info": {
          ".read": "auth != null",
          ".write": "auth != null && ((!data.exists() && newData.child('hostId').val() == auth.uid) || (data.exists() && data.child('hostId').val() == auth.uid))",
          
          "hostId": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "createdAt": {
            ".validate": "newData.val() == now"
          },
          "currentTaskId": {
            ".validate": "newData.val() == null || newData.isString()"
          },
          "votingEnabled": {
            ".validate": "newData.isBoolean()"
          },
          "votesRevealed": {
            ".validate": "newData.isBoolean()"
          }
        },
        
        "participants": {
          ".read": "auth != null",
          
          "$userId": {
            ".write": "auth != null && $userId == auth.uid",
            
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
            },
            "isHost": {
              ".validate": "newData.isBoolean()"
            },
            "joinedAt": {
              ".validate": "newData.val() == now"
            },
            "lastSeen": {
              ".validate": "newData.val() == now"
            },
            "connected": {
              ".validate": "newData.isBoolean()"
            }
          }
        },
        
        "tasks": {
          ".read": "auth != null",
          ".write": "auth != null && root.child('sessions').child($sessionId).child('info').child('hostId').val() == auth.uid",
          
          "$taskId": {
            "title": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 200"
            },
            "description": {
              ".validate": "newData.isString() && newData.val().length <= 1000"
            },
            "createdAt": {
              ".validate": "newData.val() == now"
            },
            "isActive": {
              ".validate": "newData.isBoolean()"
            }
          }
        },
        
        "votes": {
          ".read": "auth != null",
          ".write": "auth != null",
          
          "$userId": {
            ".write": "auth != null && $userId == auth.uid",
            
            "value": {
              ".validate": "newData.isString() && (newData.val() == '1' || newData.val() == '2' || newData.val() == '3' || newData.val() == '5' || newData.val() == '8' || newData.val() == '13' || newData.val() == '21' || newData.val() == '?' || newData.val() == 'â˜•')"
            },
            "timestamp": {
              ".validate": "newData.val() == now"
            }
          }
        }
      }
    },
    
    "$other": {
      ".read": false,
      ".write": false
    }
  }
}